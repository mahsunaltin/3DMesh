<!DOCTYPE html>
<html>
<head>
    <title>Welcome - 3DMesh Visualization</title>
    <style>
        /* Global Styles */
        body {
            font-family: 'Arial', sans-serif;
            background-color: #f0f0f0;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            height: 100vh;
            margin: 0;
        }

        header {
            margin-bottom: 30px;
            text-align: center;
        }

        header h1 {
            margin: 0;
            font-size: 4em;
            color: #007bff;
        }

        /* Data Settings Styles */
        #dataSettings {
            background-color: #fff;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            padding: 20px;
            width: 80%;
            max-width: 600px;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
        }

        #dataSettings h2 {
            margin-bottom: 15px;
            font-size: 1.5em;
            color: #333;
        }

        /* Scenario Selector Styles */
        .collapsible {
            background-color: #007bff;
            color: white;
            cursor: pointer;
            padding: 15px;
            border: none;
            text-align: left;
            outline: none;
            font-size: 16px;
            transition: background-color 0.3s ease;
            border-radius: 5px;
            margin-top: 10px;
        }

        .collapsible:hover, .collapsible.active {
            background-color: #4CAF50;
        }

        /* Collapsible Content Styles */
        .content {
            padding: 0 18px;
            max-height: 0;
            overflow: hidden;
            background-color: #f1f1f1;
            transition: max-height 0.2s ease-out;
            border-radius: 5px;
            margin: 8px;
            border: 1px solid #ddd;
            justify-content: center;
            align-items: center;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .content input {
            margin: 10px;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            justify-content: center;
            align-items: center;
            width: calc(100% - 24px);
        }

        /* Button Styles */
        button {
            background-color: #007bff;
            color: white;
            padding: 10px 15px;
            border: 1px solid #ddd;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px;
            transition: background-color 0.3s ease;
        }

        button:hover {
            background-color: red;
        }

        /* Input Group Styles */
        .input-group {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
            font-weight: bold;
            color: #333;
        }

        label {
            text-align: left;
            margin-right: 4px;
        }

        input[type="number"] {
            flex: 1;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }

        /* Scenario Selector Styles */
        #scenarioSelector {
            padding: 15px;
            border-radius: 5px;
            border: 1px solid #ddd;
            background-color: white;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            font-size: 14px;
            justify-content: center;
            align-items: center;
            margin: 10px;
            width: 100%;
            cursor: pointer;
        }

        #scenarioSelector:focus {
            border: 1px solid #007bff;
            outline: none;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        /* Button Content Styles */
        #dataSettings {
            width: 80%;
            max-width: 600px;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
        }

        #buttonContent {
            width: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
        }


        #loadingScreen {
            position: fixed;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 100;
            color: white;
            overflow: hidden;
        }

        #loadingCircle {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background-color: white;
            animation: pulse 1.5s infinite ease-in-out;
        }

        @keyframes pulse {
            0%, 100% {
                transform: scale(1);
                opacity: 1;
            }
            50% {
                transform: scale(1.5);
                opacity: 0.7;
            }
        }

    </style>
</head>
<body>

    <!-- Header Section -->
    <header>
        <h1>3DMesh Visualization</h1>
    </header>

    <!-- Data Settings Section -->
    <div id="dataSettings">
        <h2>Create Synthetic Data</h2>

        <div id="loadingScreen" style="display: none;">
            <div id="loadingCircle"></div>
        </div>         

        <!-- Dropdown for Scenario Selection -->
        <select id="scenarioSelector">
            <option value="">Select a Scenario</option>
            <option value="5">Upload a Video to Generate a Time Series Point Cloud</option>
            <option value="1">Selected Dataset Visualization</option>
            <option value="2">Synthetic Dataset: Scaled Point Cloud with Defined Anomalies</option>
            <option value="3">Synthetic Dataset: Scaled Filled Sphere Point Cloud with Sinusoidal Wave</option>
            <option value="4">Synthetic Dataset: Scaled Hollow Sphere Point Cloud with Sinusoidal Wave</option>
        </select>

        <!-- Scenario Content will be injected here -->
        <div id="scenarioContent"></div>
    </div>

    <!-- JavaScript Section -->
    <script>
        
        // Add event listener to the scenario selector
        document.getElementById('scenarioSelector').addEventListener('change', function() {
            const scenario = this.value;
            const contentDiv = document.getElementById('scenarioContent');
            contentDiv.innerHTML = ''; // Clear previous content

            if (scenario) {
                // Fetch and display the appropriate scenario inputs
                displayScenarioInputs(scenario, contentDiv);
            }
        });
        
        // Function to display the appropriate scenario inputs
        function displayScenarioInputs(scenario, container) {
            // HTML for each scenario's inputs
            const scenarios = {
                '1': `
                    <!-- Inputs for Scenario 1 -->
                    <div class="input-group">
                        <label for="readyData">Select the dataset: </label>
                        <select id="readyData">
                            <option value="serverMachineDatasetPca">Server Machine Dataset - PCA</option>
                            <option value="serverMachineDatasetUmap">Server Machine Dataset - UMAP</option>
                            <option value="serverMachineDatasetTsne">Server Machine Dataset - t-SNE</option>
                            <option value="serverMachineDatasetAutoencoder">Server Machine Dataset - Auto-Encoder</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label for="startIndex">Start Index: </label>
                        <input id="startIndex" type="number" value="0">
                    </div>
                    <div class="input-group">
                        <label for="endIndex">End Index: </label>
                        <input id="endIndex" type="number" value="100">
                    </div>

                    <!-- Fetch Data Button -->
                    <div id="buttonContent">
                        <button id="fetchDataButtonScenario1">Fetch Data</button>
                    </div>
                `,
                '2': `
                    <!-- Inputs for Scenario 2 -->
                    <div class="input-group">
                        <label for="numPoints2">Number of Points: </label>
                        <input id="numPoints2" type="number" value="500">
                    </div>
                    <div class="input-group">
                        <label for="numFrames2">Number of Frames: </label>
                        <input id="numFrames2" type="number" value="30">
                    </div>
                    <div class="input-group">
                        <label for="noiseLevel1">Noise Level: </label>
                        <input id="noiseLevel1" type="number" value="0.1">
                    </div>
                    <div class="input-group">
                        <label for="anomalyLevel">Anomaly Level: </label>
                        <input id="anomalyLevel" type="number" value="0.1">
                    </div>

                    <!-- Fetch Data Button -->
                    <div id="buttonContent">
                        <button id="fetchDataButtonScenario2">Fetch Data</button>
                    </div>
                `,
                '3': `
                    <!-- Inputs for Scenario 3 -->
                    <div class="input-group">
                        <label for="numPoints3">Number of Points: </label>
                        <input id="numPoints3" type="number" value="500">
                    </div>
                    <div class="input-group">
                        <label for="numFrames3">Number of Frames: </label>
                        <input id="numFrames3" type="number" value="30">
                    </div>
                    <div class="input-group">
                        <label for="minScale1">Minimum Scale: </label>
                        <input id="minScale1" type="number" value="0.5">
                    </div>
                    <div class="input-group">
                        <label for="maxScale1">Maximum Scale: </label>
                        <input id="maxScale1" type="number" value="2.0">
                    </div>
                    <div class="input-group">
                        <label for="numCycles1">Number of Cycles: </label>
                        <input id="numCycles1" type="number" value="5">
                    </div>
                    <div class="input-group">
                        <label for="noiseLevel2">Noise Level: </label>
                        <input id="noiseLevel2" type="number" value="0.1">
                    </div>
                    <div class="input-group">
                        <label for="anomalyPercentage1">Anomaly Percentage: </label>
                        <input id="anomalyPercentage1" type="number" value="0.1">
                    </div>
                    <div class="input-group">
                        <label for="distortionCoefficient1">Distortion Coefficient: </label>
                        <input id="distortionCoefficient1" type="number" value="0.1">
                    </div>

                    <!-- Fetch Data Button -->
                    <div id="buttonContent">
                        <button id="fetchDataButtonScenario3">Fetch Data</button>
                    </div>
                `,
                '4': `
                    <!-- Inputs for Scenario 4 -->
                    <div class="input-group">
                        <label for="numPoints4">Number of Points: </label>
                        <input id="numPoints4" type="number" value="300">
                    </div>
                    <div class="input-group">
                        <label for="numFrames4">Number of Frames: </label>
                        <input id="numFrames4" type="number" value="20">
                    </div>
                    <div class="input-group">
                        <label for="minScale2">Minimum Scale: </label>
                        <input id="minScale2" type="number" value="0.2">
                    </div>
                    <div class="input-group">
                        <label for="maxScale2">Maximum Scale: </label>
                        <input id="maxScale2" type="number" value="1.5">
                    </div>
                    <div class="input-group">
                        <label for="numCycles2">Number of Cycles: </label>
                        <input id="numCycles2" type="number" value="3">
                    </div>
                    <div class="input-group">
                        <label for="noiseLevel3">Noise Level: </label>
                        <input id="noiseLevel3" type="number" value="0.1">
                    </div>
                    <div class="input-group">
                        <label for="anomalyPercentage2">Anomaly Percentage: </label>
                        <input id="anomalyPercentage2" type="number" value="0.1">
                    </div>
                    <div class="input-group">
                        <label for="distortionCoefficient2">Distortion Coefficient: </label>
                        <input id="distortionCoefficient2" type="number" value="0.1">
                    </div>

                    <!-- Fetch Data Button -->
                    <div id="buttonContent">
                        <button id="fetchDataButtonScenario4">Fetch Data</button>
                    </div>
                `,
                '5': `
                    <!-- Inputs for Scenario 5 -->
                    <div class="input-group">
                        <label for="video">Video: </label>
                        <input id="video" type="file" accept="video/*">
                    </div>
                    <div class="input-group">
                        <label for="numPoints5">Number of Points per Frame: </label>
                        <input id="numPoints5" type="number" value="30">
                    </div>

                    <!-- Fetch Data Button -->
                    <div id="buttonContent">
                        <button id="fetchDataButtonScenario5">Upload and Visualize</button>
                    </div>
                `
            };

            // Inject the relevant HTML into the container
            container.innerHTML = scenarios[scenario];

            // Scenario 1
            const fetchDataButton = container.querySelector('#fetchDataButtonScenario1');
            if (fetchDataButton) {
                fetchDataButton.addEventListener('click', function() {
                    // Fetch data logic for Scenario 1
                    const readyData = document.getElementById('readyData').value;
                    const startIndex = document.getElementById('startIndex').value;
                    const endIndex = document.getElementById('endIndex').value;

                    // Redirect to visualization.html with query parameters
                    window.location.href = `visualization.html?scenario=1&readyData=${readyData}&startIndex=${startIndex}&endIndex=${endIndex}`;
                });
            }

            // Scenario 2
            const fetchDataButton2 = container.querySelector('#fetchDataButtonScenario2');
            if (fetchDataButton2) {
                fetchDataButton2.addEventListener('click', function() {
                    // Fetch data logic for Scenario 2
                    const numFrames = document.getElementById('numFrames2').value;
                    const numPointsPerFrame = document.getElementById('numPoints2').value;
                    const noiseLevel = document.getElementById('noiseLevel1').value;
                    const anomalyLevel = document.getElementById('anomalyLevel').value;

                    // Redirect to visualization.html with query parameters
                    window.location.href = `visualization.html?scenario=2&numFrames=${numFrames}&numPointsPerFrame=${numPointsPerFrame}&noiseLevel=${noiseLevel}&anomalyLevel=${anomalyLevel}`;
                });
            }

            // Scenario 3
            const fetchDataButton3 = container.querySelector('#fetchDataButtonScenario3');
            if (fetchDataButton3) {
                fetchDataButton3.addEventListener('click', function() {
                    // Fetch data logic for Scenario 3
                    const numPoints = document.getElementById('numPoints3').value;
                    const numFrames = document.getElementById('numFrames3').value;
                    const minScale = document.getElementById('minScale1').value;
                    const maxScale = document.getElementById('maxScale1').value;
                    const numCycles = document.getElementById('numCycles1').value;
                    const noiseLevel = document.getElementById('noiseLevel2').value;
                    const anomalyPercentage = document.getElementById('anomalyPercentage1').value;
                    const distortionCoefficient = document.getElementById('distortionCoefficient1').value;

                    // Redirect to visualization.html with query parameters
                    window.location.href = `visualization.html?scenario=3&numPoints=${numPoints}&numFrames=${numFrames}&scaleMin=${minScale}&scaleMax=${maxScale}&numCycles=${numCycles}&noiseLevel=${noiseLevel}&anomalyPercentage=${anomalyPercentage}&distortionCoefficient=${distortionCoefficient}`;
                });
            }

            // Scenario 4
            const fetchDataButton4 = container.querySelector('#fetchDataButtonScenario4');
            if (fetchDataButton4) {
                fetchDataButton4.addEventListener('click', function() {
                    // Fetch data logic for Scenario 4
                    const numPoints = document.getElementById('numPoints4').value;
                    const numFrames = document.getElementById('numFrames4').value;
                    const minScale = document.getElementById('minScale2').value;
                    const maxScale = document.getElementById('maxScale2').value;
                    const numCycles = document.getElementById('numCycles2').value;
                    const noiseLevel = document.getElementById('noiseLevel3').value;
                    const anomalyPercentage = document.getElementById('anomalyPercentage2').value;
                    const distortionCoefficient = document.getElementById('distortionCoefficient2').value;

                    // Redirect to visualization.html with query parameters
                    window.location.href = `visualization.html?scenario=4&numPoints=${numPoints}&numFrames=${numFrames}&scaleMin=${minScale}&scaleMax=${maxScale}&numCycles=${numCycles}&noiseLevel=${noiseLevel}&anomalyPercentage=${anomalyPercentage}&distortionCoefficient=${distortionCoefficient}`;
                });
            }

            // Scenario 5
            const fetchDataButton5 = container.querySelector('#fetchDataButtonScenario5');
            if (fetchDataButton5) {
                fetchDataButton5.addEventListener('click', function() {
                    const numPoints = document.getElementById('numPoints5').value;
                    const video = document.getElementById('video').files[0];
                    const formData = new FormData();
                    formData.append("file", video);
                    formData.append("num_points_per_frame", numPoints);

                    // Show loading screen
                    showLoadingScreen();

                    fetch('http://127.0.0.1:8000/uploadvideo/', {
                        method: 'POST',
                        body: formData
                    })
                    .then(response => response.json())
                    .then(data => {
                        // Redirect to visualization.html with data reference
                        const dataRef = data.data_id;
                        hideLoadingScreen();
                        window.location.href = `visualization.html?scenario=5&dataRef=${dataRef}`;
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        hideLoadingScreen();
                    });
                });
            }


            function hideLoadingScreen() {
                const loadingScreen = document.getElementById('loadingScreen');
                if (loadingScreen) {
                    loadingScreen.style.display = 'none';
                }
            }

            function showLoadingScreen() {
                const loadingScreen = document.getElementById('loadingScreen');
                if (loadingScreen) {
                    loadingScreen.style.display = 'flex'; // or 'flex' if your loading screen is a flex container
                }
            }

            
        }
    </script>
</body>
</html>
